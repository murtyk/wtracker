# create GrantJobLeadCount records
ajl = AutoJobLeads.new
ajl.grants_for_auto_leads.each do |grant|
  Account.current_id = grant.account_id
  Grant.current_id = grant.id

  trainee_ids = Trainee.pluck(:id)

  lead_counts = AutoSharedJob.where(trainee_id: trainee_ids).group('Date(created_at)').count

  lead_counts.each do |k, v|
    GrantJobLeadCount.create(sent_on: k, count: v)
  end
end

#create and update TraineeAutoLeadStatus
ajl = AutoJobLeads.new
ajl.grants_for_auto_leads.each do |grant|
  Account.current_id = grant.account_id
  Grant.current_id = grant.id

  grant.trainees.each do |t|
    viewed = t.auto_shared_jobs.where('status > 0 and status < 4').count > 0
    applied = t.auto_shared_jobs.where('status = 2').count > 0
    t.create_trainee_auto_lead_status(viewed: viewed, applied: applied)
  end
end

Pending:

1. delete TI unused attributes
2. delete Grant Trainee Status MVC and routes